{"5":{"id":"5","parent_id":"0","title":"dsad","body":"<pre>\/\/ ==UserScript==\n\/\/ @name        loader_book\n\/\/ @namespace   http:\/\/veriki.ru\/*\n\/\/ @version     1\n\/\/ @grant       none\n\/\/ ==\/UserScript==\nvar LS = localStorage,\n    wlh = window.location.href,\n    D = document,\n    W = window;\nW.onload = function(){ main(); }\nfunction $(id){\n  var i = id;\n  if (i.tagName) {\n    return i;\n  }\n  if (i == D || i == W) {\n   return i;\n  }\n  return D.getElementById(i);\n}\nfunction $$(tagName, parent){\n  var i = tagName, p = parent;\n  if (!p) {\n    p = D;\n  }\n  return p.getElementsByTagName(i);\n}\nfunction $$$(tagName, parent, callback) {\n  var i = tagName, p = parent;\n  var ls = $$(i, p);\n  if (ls && ls.length) {\n    for (var i = 0; i < ls.length; i++) {\n      callback(ls[i]);\n    }\n  }\n}\nfunction trim(s) {\n  s = s.replace(\/\u00a0\/gi, '');\n  s = s.replace(\/^\\s+([^\\s])\/gi, '$1');\n  s = s.replace(\/([^\\s])\\s+$\/gi, '$1');\n  return s;\n}\nfunction main() {\n  var ls = loadVoc(), i, obj;\n  \/\/LS.removeItem('voc');return;\n  \n  for (i = 0; i < 41 \/* ls.length*\/; i++) {\n    obj = ls[i];\n    console.log(i);\n    if (!obj.data && obj.link != wlh) {\n      window.location.href = obj.link;\n      return;\n    }\n    if (!obj.data && obj.link == wlh) {\n      saveData(ls, i);\n      return;\n    }\n  }\n  var s = LS.getItem('voc');\n  var ta = D.createElement('textarea');\n  ta.id = 'out';\n  ta.style.width = '99%';\n  ta.rpws = 25;\n  D.body.appendChild(ta);\n  ta.value = s;\n}\n\/\/main();\n\/\/================================STORAGE FUNCTIONS===================================\n\nfunction saveData(ls, idx){\n  var table = $$('table')[0];\n  var td = $$('td')[3];\n  var pList = [];\n  var iList = [];\n  $$$('img', td, function(img){\n    var canvas = document.createElement('canvas'),       \/\/\u0421\u043e\u0437\u0434\u0430\u043b\u0438 \"\u0445\u043e\u043b\u0441\u0442\"\n\t\t    context;\n\t      canvas.width  = img.width;               \/\/\u0448\u0438\u0440\u0438\u043d\u0430 \u0445\u043e\u043b\u0441\u0442\u0430\n\t      canvas.height = img.height;              \/\/\u0432\u044b\u0441\u043e\u0442\u0430 \u0445\u043e\u043b\u0441\u0442\u0430\n\t\n\t\tD.body.appendChild(canvas); \/\/\u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443 \u043d\u0430\u0448 \u0445\u043e\u043b\u0441\u0442, \u043c\u043e\u0436\u043d\u043e \u043d\u0430\u0447\u0438\u043d\u0430\u0442\u044c \u0440\u0438\u0441\u043e\u0432\u0430\u0442\u044c\n\t\tcontext = canvas.getContext(\"2d\");   \/\/\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442 \u0440\u0438\u0441\u043e\u0432\u0430\u043d\u0438\u044f\n    context.drawImage(img, 0, 0);\n    img.src = canvas.toDataURL();\n    D.body.removeChild(canvas);\n    console.log('I = ' + idx);\n  });\n  td.innerHTML = td.innerHTML.replace(\/<table\/gi, '<p><table');\n  td.innerHTML = td.innerHTML.replace(\/<\\\/table>\/gi, '<\/table><\/p>');\n  $$$('p', td, function(p){\n    if (trim(p.innerHTML) && !(~p.innerHTML.indexOf('\u0441\u043e\u0434\u0435\u0440\u0436\u0430\u043d\u0438\u0435<\/a>')) ) {\n      pList.push( p.innerHTML );\n    }\n  });\n  ls[idx].data = pList;\n  LS.setItem('voc', JSON.stringify(ls));\n  main();\n}\n\nfunction loadVoc() {\n  if (!LS.getItem('voc')) {\n    parseAndSaveVoc();\n  }\n  var oVoc = LS.getItem('voc');\n  if (!LS.getItem('voc')) {\n    alert(\"Unable load vocabulary! loadVoc\");\n  } else {\n    return JSON.parse(oVoc);\n  }\n}\n\n\nfunction parseAndSaveVoc() {\n  if (wlh == 'http:\/\/veriki.ru\/000_uchebniki\/04750sad_i_ogorod\/100_virashivanie_tabaka_razkicjnih_sortov_sergeev_2005\/000.htm') {\n    var table = $$('table')[0];\n    table = $$('table', table)[0];\n    var aList = [];\n    $$$('a', table, function(a) {\n      aList.push( {link: a.href, title: a.innerHTML, data: null } );\n    });\n    LS.setItem('voc', JSON.stringify(aList));\n  } else {\n    alert(\"Invali8d vocabulary url!\");\n  }\n}\n<\/pre>","date_create":"2015-06-12 14:56:02","date_modify":"2015-06-12 15:07:48","uid":"61","name":"aso@qwe.ru","surname":"Andrey"},"6":{"id":"6","parent_id":"0","title":"\u0425\u043c! \u041d\u0435\u043f\u043b\u043e\u0445\u043e!","body":"\u0414\u0430, \u044f \u0442\u0430\u043a \u0441\u0447\u0438\u0442\u0430\u044e!","date_create":"2015-06-17 11:23:15","date_modify":"2015-06-17 11:23:15","uid":"56","name":"Nox","surname":"Qwe"}}